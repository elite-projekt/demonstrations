<!DOCTYPE html>
<html lang="de">
<head>
	<meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link href="images/favicon.ico" rel="icon"/>

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="css/bootstrap.min.css">

    <!-- Style -->
    <link rel="stylesheet" href="css/style.css">
    <title>MITM Demo</title>
</head>
<body>

<script>

function stop_demo () {
  const xhr = new XMLHttpRequest();
  xhr.open('GET', `http://127.0.0.1:5000/orchestration/stop/demo/uhh_ducky_mitm`);
  xhr.send();
}

let end_button = `
<button type="button" onclick="stop_demo()" style="width: 20%;" class="btn">
  <span class="align-middle btn btn-block btn-primary mt-3">Demo stoppen</span>
</button>
`

function submit_form(theForm) {
	let info_string_elite= `
  <h1>
  Login erfolgreich!
</h1>
<br>
Sie haben es geschafft die Proxy-Einstellungen zurückzusetzen und auf die korrekte Seite zu gelangen. Herzlichen Glückwunsch.
<br>
Einige Tipps: <br>
<ul>
<li>Immer darauf achten, dass die besuchte Domain korrekt ist, über eine Verschlüsselung verfügt und das genutzte Zertifikat vertrauenswürdig ist.</li>
<br>
 <li> Einen sicheren Browser verwenden. Browser wie zum Beispiel Firefox blockieren den Zugriff auf Domains, wenn sich plötzlich das Zertifikat ändert. Dieser Demonstrator wäre unter Firefox nicht möglich gewesen.</li>
 <br>
<li> E-Mails sollten immer mit einer digitalen Signatur versehen werden (S/MIME oder OpenPGP). </li>
 <br>
<li> USB-Geräten sollte nie blind vertraut werden. </li>
 <br>
<li> Die vertrauten Zertifikate und Einstellungen im Betriebsystem sollten regelmäßig überprüft werden. </li>
</ul>
  ${end_button}
		`;
	let info_string_evil= `
  <h1>
Ihre Daten wurden gestohlen!
</h1>
<br>

Username: ${theForm.uname.value} <br>
Passwort: ${theForm.psw.value} <br>
<br>
Falls Sie es nicht gesehen haben: Beim Einstecken des "defekten" USB-Sticks konnten wir beliebige Befehle ausführen und haben so ihren PC infiziert.
Sie können die Demo jetzt beenden, oder sich auf dieser Seite die technischen Hintergründe des Angriffes anschauen.
<br>
${end_button}
<br>
Wir haben den Angriff genutzt, um die Proxy-Einstellungen des Betriebssystems zu ändern und ein falsches Zertifikat zu installieren.<br>
Wenn Sie auf die Adressleiste schauen, sehen Sie, dass es sich um die korrekte URL handelt. Schaut man sich jedoch das Zertifikat an, erkennt man, dass dieses nicht legitim und auf "mitmproxy" ausgestellt ist.
 <br>
 <br>
Um dies anzuzeigen, können Sie auf das Schloss neben der Adressleiste klicken und sich dann den Verbindungsstatus anzeigen lassen. Hier auf das Zertifikatssymbol (neben dem "X") klicken.

 <br>
<img src="images/about_connection_secure.png" alt="Secure connection">
 <img src="images/open_cert.png" alt="Secure connection">
 <br>
 <img src="images/cert.png" alt="Secure connection">
 <br>

Dieses Zertifikat ist offensichtlich kein legitimes und mit diesem sind wir in der Lage allen verschlüsselten Datenverkehr zu lesen und zu manipulieren.


<br><br>

Zusätzlich haben wir die Proxy-Einstellungen geändert, wodurch der Datenverkehr über einen Server vom Angreifer geleitet wird.

Suchen Sie in der Leiste am unteren Bildschirmrand mit dem Text "Suchbegriff hier eingeben" nach "Proxy" und klicken Sie auf den Eintrag "Proxy Einstellungen".
Wenn Sie in diesem Fenster nach unten Scrollen sehen Sie, dass wir die Proxyeinstellungen ihres Rechners verändert haben.
Löschen Sie den Proxy, indem Sie den Schalter von "Ein" auf "Aus" stellen.
<br>

<img src="images/proxy_settings.png" alt="Windows proxy settings">
 <br>
Dann die "STRG" und "Shift"-Taste gedrückt halten und dann "R" drücken. Hiermit wird der Browser gezwungen neue Daten vom Serveranzufordern und es wird keine lokal gespeicherte Version genutzt.

		`;
  let attacked = false;
	let overlay_text_elem = document.getElementById("text");
	if (attacked) {
		overlay_text_elem.innerHTML = info_string_evil;
	} else {
		overlay_text_elem.innerHTML = info_string_elite;
	}
	on();
	return false;
}

</script>


<nav class="navbar navbar-dark" style="background-color: #6c63ff;">
  <img src="images/Nimbus Logo.svg" height="80" class="logo" alt="">
</nav>


	<div class="preload">
		<img src="images/noun-eye-opened.png"/>
		<img src="images/noun-eye-closed.png"/>
	</div>
		<div class="content">
		<div class="container">
			<div class="row">
			<div class="col-md-6">
				<img src="images/undraw_remotely_2j6y.svg" alt="Image"
				class="img-fluid">
			</div>
			<div class="col-md-6 contents">
				<div class="row justify-content-center">
				<div class="col-md-8">
					<div class="mb-4">
					<h4>Anmeldung<br>Nimbus Account-Services</h3>
					<p class="mb-4 small">Bitte melden Sie sich mit Ihren Zugangsdaten für Nimbus Account-Services an</p>
					</div>
					<form autocomplete="off" action="#" onsubmit="return submit_form(this)">

					<div class="form-group first" id="name_field">
						<label for="name">Benutzername</label>
						<input type="text" class="form-control" id="name" name="uname" value ="internal3495">

					</div>
					<div class="form-group" id="password_field">

						<label for="password">Passwort</label>
						<div class="input-group">
						<input type="password" class="form-control" id="password" name="psw" value="tzmupMsHlbyYKjRdbE2dvjutzJzfTajhTd4lif26csi8HWKa5XMXz9Rsu4UlB0UrN9JD">
						<i toggle="#password" class="icon-eye toggle-passwort input-group-addon" data-toggle="tooltip"
							data-placement="right" title="Klicken Sie auf das Auge, um das Passwort anzuzeigen."
							id="pw-eye"></i>
						</div>

					</div>
					<div role="alert" aria-live="assertive" aria-atomic="true" class="toast {{classes}} dont-display mt-3"
						data-autohide="false" id=toast>
						<div class="toast-header">
						<strong class="mr-auto">Nimbus</strong>
						<button type="button" class="ml-2 mb-1 close" data-dismiss="toast" aria-label="Close">
							<span aria-hidden="true">&times;</span>
						</button>
						</div>
						<div class="toast-body">
						Der Benutzername oder das Passwort ist nicht korrekt. Bitte versuchen Sie es erneut.
						</div>
					</div>
					<input type="submit" value="Anmelden" class="btn btn-block btn-primary mt-3">
          </form>
				</div>
				</div>

			</div>

			</div>
		</div>
	</div>

<script src="js/jquery-3.3.1.min.js"></script>
<script src="js/main.js"></script>



<!-- <div id="overlay" onclick="off()"> -->
<div id="overlay">
  <a href="javascript:void(0)" class="closebtn" onclick="off()">&times;</a>
  <div id="text">
  </div>
</div>

<script>
function on() {
  document.getElementById("overlay").style.display = "block";
}

function off() {
  document.getElementById("overlay").style.display = "none";
}
</script>

</body>
</html>
