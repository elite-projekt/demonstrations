<!DOCTYPE html>
<html lang="de">
<head>
	<meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link href="images/favicon.ico" rel="icon"/>

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="css/bootstrap.min.css">

    <!-- Style -->
    <link rel="stylesheet" href="css/style.css">
    <title>MITM Demo</title>
<style>
/* table container style */
.table-container {
  width: 90%;
  margin: 0 auto;
}

/* table style */
#data-table {
  border-collapse: collapse;
  width: 100%;
  max-width: 800px;
  margin: 0 auto;
}

/* table header style */
#data-table th {
  background-color: #f2f2f2;
  border: 1px solid #ddd;
  padding: 8px;
  text-align: left;
}

/* table row style */
#data-table tr {
  border-bottom: 1px solid #ddd;
}

/* table row hover style */
#data-table tr:hover {
  background-color: #f2f2f2;
}

/* table cell style */
#data-table td {
  border: 1px solid #ddd;
  padding: 8px;
}

/* table cell style for usernames */
#data-table td.username {
  font-weight: bold;
}

</style>
</head>
<body>

<script>


function submit_form(theForm) {
  let attacked = false;
	return false;
}

</script>


<nav class="navbar navbar-dark" style="background-color: #6c63ff;">
  <img src="images/Nimbus Logo.svg" height="80" class="logo" alt="">
</nav>

<h1>Gestohlene Zugangsdaten</h1>

<table id="data-table">
      <thead>
        <tr>
          <th>Username</th>
          <th>Password</th>
        </tr>
      </thead>
      <tbody>
        <!-- Data rows will be added dynamically by the JavaScript function -->
      </tbody>
</table>
<div id="text"></div>

<script>
  function stop_demo () {
    const xhr = new XMLHttpRequest();
    xhr.open('GET', `http://127.0.0.1:5000/orchestration/stop/demo/uhh_ducky_mitm`);
    xhr.send();
  }

  let end_button = `
<button type="button" onclick="stop_demo()" style="width: 20%;" class="btn">
  <span class="align-middle btn btn-block btn-primary mt-3">Demo stoppen</span>
</button>
`
  let info_string_evil=`
  Falls Sie es nicht gesehen haben: Beim Einstecken des "defekten" USB-Sticks konnten wir beliebige Befehle ausführen und haben so ihren PC infiziert.
Sie können die Demo jetzt beenden, oder sich auf dieser Seite die technischen Hintergründe des Angriffes anschauen.
<br>
${end_button}
<br>
Wir haben den Angriff genutzt, um die Proxy-Einstellungen des Betriebssystems zu ändern und ein falsches Zertifikat zu installieren.<br>
Wenn Sie auf die Adressleiste schauen, sehen Sie, dass es sich um die korrekte URL handelt. Schaut man sich jedoch das Zertifikat an, erkennt man, dass dieses nicht legitim und auf "mitmproxy" ausgestellt ist.
 <br>
 <br>
Um dies anzuzeigen, können Sie auf das Schloss neben der Adressleiste klicken und sich dann den Verbindungsstatus anzeigen lassen. Hier auf das Zertifikatssymbol (neben dem "X") klicken.

 <br>
<img src="images/about_connection_secure.png" alt="Secure connection">
 <img src="images/open_cert.png" alt="Secure connection">
 <br>
 <img src="images/cert.png" alt="Secure connection">
 <br>

Dieses Zertifikat ist offensichtlich kein legitimes und mit diesem sind wir in der Lage allen verschlüsselten Datenverkehr zu lesen und zu manipulieren.
<br><br>
Zusätzlich haben wir die Proxy-Einstellungen geändert, wodurch der Datenverkehr über einen Server vom Angreifer geleitet wird.
    `;



  function updateTable() {
  // create XHR object
  var xhr = new XMLHttpRequest();

  // define function to be executed when response is received
    xhr.onreadystatechange = function() {
    // check if request is complete and response is OK
    if (this.readyState === 4 && this.status === 200) {
      // parse response as JSON
      var data = JSON.parse(this.responseText);

      // get reference to table and tbody elements
      var table = document.getElementById("data-table");
      var tbody = table.getElementsByTagName("tbody")[0];

      // clear existing table rows
      tbody.innerHTML = "";

      // loop through each data entry
      data.forEach(function(entry) {
        var username = entry[0];
        var password = entry[1];

        // create new row and cells for username and password
        var row = tbody.insertRow(0);
        var usernameCell = row.insertCell(0);
        var passwordCell = row.insertCell(1);

        // add data to cells
        usernameCell.innerHTML = username;
        passwordCell.innerHTML = password;

        // set row ID to username
        row.id = username;
      });
    }
  };

  // set request parameters
  xhr.open("GET", "http://127.0.0.1:5000/orchestration/data/demo/uhh_ducky_mitm", true);

  // send request
  xhr.send();

  // call function again after one second
  setTimeout(updateTable, 1000);
}
updateTable();


  let text_elem = document.getElementById("text");
  text_elem.innerHTML = `
    <div class="centered-text">
    <p> Diese Tabelle zeigt, welche Zugangsdaten der Angreifer über Sie in Erfahrung gebracht hat. Wenn Sie auf der <a href="https://nimbus.de" target="_blank" rel="noopener noreferrer">Nimbus Login Seite</a> weitere Daten eingeben, tauchen diese in dieser Tabelle auf. </p>

  ${info_string_evil}

    </div>`;

</script>

</body>
</html>
